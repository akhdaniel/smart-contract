<t t-name="vit_dashboard.SarlogDashboard" owl="1">
    <div class="p-4" style="max-height:100vh; overflow-y:auto;">
        <h2 class="fw-bold text-center text-primary mb-4">Dashboard Sarlog</h2>



        <!-- <div class="col-12 col-md-2" style="width:200px; float:right; margin-top:-55px; margin-right:100px;">
            <div class="form-control px-1 m-0">
                <select
                    t-on-change="onYearChange"
                    class="form-select border-0">
                    <option value=""> Pilih Tahun</option>
                    <t t-set="currentYear" t-value="new Date().getFullYear()"/>
                    <t t-foreach="[currentYear - 5, currentYear - 4, currentYear - 3, currentYear - 2, currentYear - 1, currentYear]" t-as="th" t-key="th">
                        <option 
                            t-att-value="th"
                            t-att-selected="state.selectedYear == th ? true : undefined"
                            t-esc="th"/>
                    </t>
                </select>
            </div>
        </div> -->


        <div class="row mx-3">

            <!-- KIRI: Total & Persentase -->
            <div class="col-2 d-flex flex-column align-items-stretch"
                style="margin-top:20px; margin-bottom:20px; gap:45px;">

                <!-- Total RKAP -->
                <div class="text-white shadow bg-itb-light-blue d-flex flex-column align-items-center justify-content-center text-center w-100"
                    style="border-radius:10px; min-height:150px; padding:20px;">
                    <div class="fw-semibold fs-4" style="opacity:0.95;">Total RKAP</div>
                    <div class="fw-bold fs-2 mt-1">
                        <t t-out="(state.totalSummary.pagu || 0).toLocaleString()"/>
                    </div>
                    <div class="fw-semibold fs-4 mt-3" style="opacity:0.95;">Total Realisasi</div>
                    <div class="fw-bold fs-2 mt-1">
                        <t t-out="(state.totalSummary.realisasi || 0).toLocaleString()"/>
                    </div>
                </div>

                <!-- Persentase Realisasi Total -->
                <div class="text-white shadow bg-itb-light-blue d-flex flex-column align-items-center justify-content-center text-center w-100"
                    style="border-radius:10px; min-height:150px; padding:20px;">
                    <div class="fw-semibold fs-4" style="opacity:0.95;">Persentase Realisasi</div>
                    <div class="fw-bold fs-2 mt-1">
                        <t t-out="(state.totalSummary.persen || 0).toFixed(2) + '%'"/>
                    </div>
                </div>
            </div>

            <!-- TENGAH: Master Budget Cards -->
            <div class="col-8">
                <div class="row g-4">
                    <t t-foreach="state.masterBudgets" t-as="mb" t-key="mb.id">
                        <div class="col-4" style="margin-top:20px; margin-bottom:10px;">
                            <NumberCardSarlog 
                                title="mb.name"
                                bgColor="'bg-white'"
                                model="'vit.budget_rkap'"
                                field="'master_budget_summary'"
                                domain="[]"
                            />
                        </div>
                    </t>
                </div>

                <!-- <div class="mt-5 px-5">
                    <h4 class="fw-bold text-primary mb-3 text-center">
                        Persentase Droping per Kanwil
                    </h4>
                    <div style="overflow-x: auto; white-space: nowrap; padding-bottom: 10px;">
                        <div class="d-flex align-items-end gap-4 px-4"
                            style="height: 320px; width: max-content;">
                            <t t-foreach="state.kanwilDroping" t-as="d" t-key="d.kanwil_name">
                                <div class="text-center" style="flex: 0 0 70px;">
                                    <div class="fw-semibold mb-1" style="font-size: 12px;">
                                        <t t-esc="d.persen_droping"/>%
                                    </div>
                                    <div class="position-relative mx-auto"
                                        style="width: 40px; background: #3498db; border-radius: 6px 6px 0 0;"
                                        t-att-style="
                                            'height:' + (Math.min(d.persen_droping, 100) * 3) + 'px; transition: height 0.8s ease; min-height:5px;'
                                        ">
                                    </div>
                                    <div class="small text-muted mt-1" style="white-space: nowrap; font-size: 12px;">
                                        <t t-esc="d.kanwil_name"/>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </div>
                </div> -->


                <div class="mt-5 px-5">
                    <h4 class="fw-bold text-primary mb-3 text-center">
                        Persentase Droping per Kanwil
                    </h4>

                    <!-- container chart -->
                    <div class="d-flex justify-content-center">
                        <div class="position-relative" style="height:400px; width:90%; max-width:1200px;">
                            <canvas id="dropingChart"></canvas>
                        </div>
                    </div>

                </div>







            </div>

            <!-- KANAN: Persentase Realisasi per Kanwil -->
            <div class="col-2" style="margin-top:-50px; margin-bottom:20px;">

                <div class="form-control px-1 m-0 mb-3">
                    <select
                        t-on-change="onYearChange"
                        class="form-select border-0"
                    >
                        <option value="">-- Pilih Tahun --</option>
                        <t t-set="currentYear" t-value="new Date().getFullYear()"/>
                        <t t-foreach="[currentYear - 5, currentYear - 4, currentYear - 3, currentYear - 2, currentYear - 1, currentYear]" t-as="th" t-key="th">
                            <option 
                                t-att-value="th"
                                t-att-selected="state.selectedYear == th ? true : undefined"
                                t-esc="th"
                            />
                        </t>
                    </select>
                </div>



                <h5 class="fw-bold text-primary mb-3 text-center">Persentase Realisasi per Kanwil</h5>

                <div style="max-height: 700px; overflow-y: auto; padding-right: 5px;">
                    <t t-if="state.kanwilRealisasi &amp;&amp; state.kanwilRealisasi.length">
                        <t t-foreach="state.kanwilRealisasi" t-as="r" t-key="r.kanwil_name">
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span><t t-esc="r.kanwil_name"/></span>
                                    <span><t t-esc="r.persen_realisasi"/>%</span>
                                </div>
                                <div style="width:100%; height:20px; background:#ddd; border-radius:10px; overflow:hidden;">
                                    <div t-att-style="'height:100%; width:' + r.persen_realisasi + '%; background-color:#2ecc71;'"></div>
                                </div>
                            </div>
                        </t>
                    </t>
                    <t t-if="!state.kanwilRealisasi || !state.kanwilRealisasi.length">
                        <div class="text-center text-muted">Tidak ada data realisasi</div>
                    </t>
                </div>
            </div>



        </div>



    </div>
</t>
